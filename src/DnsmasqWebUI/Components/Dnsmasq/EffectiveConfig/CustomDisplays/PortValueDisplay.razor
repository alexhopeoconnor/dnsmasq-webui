@namespace DnsmasqWebUI.Components.Dnsmasq.EffectiveConfig.CustomDisplays
@using DnsmasqWebUI.Models.Dnsmasq

@* Value-only display for the port option. IsActiveEditor is cascaded from FieldDisplay (true only for the single active field in edit mode). When active editor and not readonly: number input; else: view text. *@
@if (IsActiveEditor && Descriptor.GetSource()?.IsReadOnly != true)
{
    var port = Descriptor.GetValue() is int p ? p : 53;
    <input type="number" class="form-control form-control-sm" style="max-width: 6rem;" min="1" max="65535" value="@port" @oninput="OnPortInput" @onfocusout="OnCommitRequested" />
}
else
{
    @(Descriptor.GetValue() is int port ? $"{port} (default DNS port)" : "(not set)")
}

@code {
    [Parameter] public EffectiveConfigFieldDescriptor Descriptor { get; set; } = null!;
    [CascadingParameter] public bool IsActiveEditor { get; set; }
    [CascadingParameter] public EventCallback<FocusEventArgs> OnCommitRequested { get; set; }
    [Parameter] public EventCallback<object?> ValueChanged { get; set; }

    private async Task OnPortInput(ChangeEventArgs e)
    {
        if (int.TryParse(e.Value?.ToString(), out var port) && port >= 1 && port <= 65535)
            await ValueChanged.InvokeAsync(port);
        else
            await ValueChanged.InvokeAsync(null);
    }
}

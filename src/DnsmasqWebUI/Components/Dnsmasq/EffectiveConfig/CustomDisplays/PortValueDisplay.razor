@namespace DnsmasqWebUI.Components.Dnsmasq.EffectiveConfig.CustomDisplays
@using DnsmasqWebUI.Models.Dnsmasq

@* Value-only display for the port option. Edit mode: number input (unless readonly); View: text with "(default DNS port)". *@
@if (DisplayMode == EffectiveConfigDisplayMode.Edit && Descriptor.GetSource()?.IsReadOnly != true)
{
    var port = Descriptor.GetValue() is int p ? p : 53;
    <input type="number" class="form-control form-control-sm" style="max-width: 6rem;" min="1" max="65535" value="@port" @oninput="OnPortInput" />
}
else
{
    @(Descriptor.GetValue() is int port ? $"{port} (default DNS port)" : "(not set)")
}

@code {
    [Parameter] public EffectiveConfigFieldDescriptor Descriptor { get; set; } = null!;
    [CascadingParameter] public EffectiveConfigDisplayMode DisplayMode { get; set; } = EffectiveConfigDisplayMode.View;
    [Parameter] public EventCallback<int?> PortChanged { get; set; }

    private async Task OnPortInput(ChangeEventArgs e)
    {
        if (int.TryParse(e.Value?.ToString(), out var port) && port >= 1 && port <= 65535)
            await PortChanged.InvokeAsync(port);
        else
            await PortChanged.InvokeAsync(null);
    }
}

@namespace DnsmasqWebUI.Components.EffectiveConfig.CustomDisplays
@using DnsmasqWebUI.Models.Dnsmasq
@inherits EffectiveConfigValueDisplayBase

@* Value-only display for the port option. Pending value shown until save. *@
@if (IsActiveEditor && Descriptor.GetSource()?.IsReadOnly != true)
{
    var port = GetEffectiveDisplayValue() is int p ? p : 53;
    <input type="number" class="form-control form-control-sm" style="max-width: 6rem;" min="1" max="65535" value="@port" @oninput="OnPortInput" @onfocusout="OnCommitRequested" />
}
else
{
    @(GetEffectiveDisplayValue() is int port ? $"{port} (default DNS port)" : "(not set)")
}

@code {
    private async Task OnPortInput(ChangeEventArgs e)
    {
        if (int.TryParse(e.Value?.ToString(), out var port) && port >= 1 && port <= 65535)
            await NotifyValueChanged(port);
        else
            await NotifyValueChanged(null);
    }
}
